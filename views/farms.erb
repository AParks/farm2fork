<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
  <script src="http://code.jquery.com/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false" type="text/javascript"></script>
</head>




  <script type="text/javascript">
    var pointsArray = new Array();


    $("#submit").click( function(){
        var value = $('#zipCode').val();
        var lat = 0  
        var lng = 0
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({address: value},
        function(results_array, status) { 
            lat = results_array[0].geometry.location.lat()
            lng = results_array[0].geometry.location.lng()
         }   
    );

        $.post( '/farms/getData', {x: lat, y: lng}, function(data){
          console.log("data is received!");
          }
        });
    });


function load() {
    // Centering isn't quite right
    var centerLatLng = new google.maps.LatLng(pointsArray[0], pointsArray[1]);
    var mapOptions = {
              zoom: 16,
              center: centerLatLng,
              mapTypeId: google.maps.MapTypeId.ROADMAP
            }
    var map = new google.maps.Map(document.getElementById('map1'), mapOptions);

    var counter = 0;
    var vertices = new Array();

    for (var i = 0; i < pointsArray.length-1; i=i+2) {
        var point = new google.maps.LatLng(pointsArray[i],pointsArray[i+1]);
        createMarker(point, map);
        vertices[counter]=point;
        counter++;
    }
}

// Creates a marker whose info window displays the coordinates of the marker.
function createMarker(point, map) {
    var markerInfoWindow = new google.maps.InfoWindow({
        content: "Coordinates: (" + point.lat() +","+ point.lng() +")"
    });

    var marker = new google.maps.Marker({
        position: point,
        map: map
    });

    google.maps.event.addListener(marker, 'click', function() {
        markerInfoWindow.open(map, marker);
    });
}

    $("#submit").click( function(){
        var value = $('#zipCode').val();
        var lat = 0  
        var lng = 0
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({address: value},
        function(results_array, status) { 
            lat = results_array[0].geometry.location.lat()
            lng = results_array[0].geometry.location.lng()
         }   
    );

        $.post( '/farms/getData', {x: lat, y: lng}, function(data){
          console.log("data is received!");
        for(var i=0; i<@docs.length; i++){
            var element = $("<h1 />");
            element.html(data.markets[i]);
            $("#zipData").append( element );
          }
        });
    });

  </script>

 <body onload="load()" >



  <input id="zipCode" type="" />
  <button id="submit">submit</button>

  <div class="map" id="map1"> 

 </div>

 </body>
</html>

